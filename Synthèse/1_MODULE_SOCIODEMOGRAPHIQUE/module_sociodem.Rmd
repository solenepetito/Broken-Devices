---
title: 'Broken devices : Module sociodémographique '
author: "Solène PETITO"
output:
  html_document: default
  pdf_document: default
  word_document: default
date: "2024-08-20"
editor_options: 
  markdown: 
    wrap: 72
---

# **MODULE SOCIODÉMOGRAPHIQUE :**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
############### MODULE 1 : Chargement des librairies

library(openxlsx)
library(readxl)
library(ggplot2)
library(stringr)
library(tibble)
library(dplyr)
library(plotly) # permet de faire des graphes intéractifs
library(corrplot) # permet de réqliser des matrices de corrélation
library(tidyr)
library(RColorBrewer) # librairie pour les palettes de couleurs
library(viridis) # palette de couleurs > 25 nuances
library(Polychrome)
library(gridExtra) # afficher les graphes côte à côte
library(grid)

```

```{r include=FALSE}
############### MODULE 2 : Création de fonctions

# fonction func1 qui prend en entrée un jeu de données (don) et le nom d'une colonne de type Cri (Caratère répétitive) de ce jeu de données (colonne), sous forme de chaine de caractères et sans préciser de numéro à la fin de celle-ci  : ex : "COHABITATION_DYSFONCTION_A" ou "GENE_PROBLEMES_A". Elle renvoit en sortie une matrice a 2 lignes et 25 colonnes, indiquant en ligne 1 le type de dysfonctionnement, et en ligne 2 une modalité moyenne calculée pour la variable donnée en entrée pour chaque type de dysfonctionnements.

func1 <- function (don,colonne){
  matrice <- matrix(0,nrow=2,ncol=25)
  matrice[1,] <- c(1:25)
  df = don[which(don$RIDENTIFICATION_PROBLEMES!="27"),]
  variable=df$RIDENTIFICATION_PROBLEMES
  for (pb in 1:25){
    vec=c()
    for (i in 1:length(variable)){
      ligne=str_extract_all(variable[i], ".{2}")[[1]]
      ligne=sub("^0+", "", ligne)
      if (pb %in% ligne){
        num=as.character(pb)
        nom_colonne=paste0(colonne,num)
        valeur=df[i,nom_colonne]
        if(!is.null(valeur) && !is.na(valeur)){
          vec=c(vec,valeur)
        }
      }
    }
    if (length(vec) > 0) {
    matrice[2, pb] <- round(mean(vec))
  } else {
    matrice[2, pb] <- 0
  }
  }
  return(matrice)
}
##########################################

# Création d'une fonction **Count_VCM** (VCM = Variable à choix multiples) permettant d'afficher pour les variables à choix multiples UNIQUEMENT, le nombre de fois où chaque modalité est renseignée dans toute la colonne. Elle prend en entrée une variable à choix multiple (*variable*), issue de la base de données, et son nombre total de modalités (*nb_de_modalites*), et renvoit une matrice indiquant en ligne 1 le numéro de la modalité, et en ligne 2 le nombre de fois où les répondants l'on choisit.

Count_VCM <- function(variable,nb_de_modalites){
  mat <- matrix(0,nrow=2,ncol=nb_de_modalites)
  mat[1,]=c(1:nb_de_modalites)
  for (i in 1:length(variable)){
    ligne=str_extract_all(variable[i],".{2}")[[1]]
    vec=sub("^0+","",ligne)
    for (j in 1:length(vec)){
      for (k in 1:ncol(mat)){
        if (vec[j]==mat[1,k]){
          mat[2,k]=mat[2,k]+ 1 # mettre "+1" à la place de "data[i,"poids"]" si on ne concidère pas les poids
        }
      }
    }
  }
  return(mat)
}

##########################################

# Pour éviter d'avoir à afficher les numéros des modalités sur chaques graphes, je stocke directement les libellés des modalités dans des vecteurs

label_RIDENTIFICATION_PROBLEME = c("Problème avec l’écran","Problème de sensibilité du tactile","Problème avec l’appareil photo","Problème avec la lampe torche ou le flash","Problème avec le GPS","Problème avec le micro","Problème de son","Problème de prise jack","Problème de chargement","Problème de batterie","Problème de Wi-Fi","Problème de capteurs","Problème de Bluetooth ou de transferts de fichiers sans fil","Problème de téléphonie","Problème d’accès à Internet","Problème avec les boutons","Problème de vibreur","Stockage saturé","Système d’exploitation non mis à jour","Applications ne pouvant pas être téléchargées ou mises à jour","Problème lié à une fonctionnalité manquante","Fonctionnalité qui ne marche plus","Dysfonctionnement logiciel","Problèmes avec des applications","Problème de lenteur","Autre")

label_ACQUISITION = c("Quelqu’un me l’a offert ou donné","Quelqu’un me l’a prêté","Je l’ai acheté","Je l’ai obtenu dans le cadre de mon contrat avec mon opérateur","Mon employeur me l’a fourni","Je l’ai loué","Je ne me souviens pas","Obtenu par un autre moyen")

label_COHABITATION = c("Dès que j’ai décelé le dysfonctionnement","Moins d’un mois","Entre 1 et 6 mois","Entre 6 mois et 2 ans","Plus de deux ans","Je ne sais pas" )

label_GENE=c("Très gênant","Plutôt gênant","Plutôt pas gênant","Pas gênant du tout")

label_INT_REPARATION= c("Oui, par moi-même","Oui, par le SAV ou un réparateur","Oui, par une connaissance","Pas pour l’instant", "Non")

label_RECENCE <- c("Dès la première utilisation","En moins de 3 mois","Entre 3 mois et 1 an","Entre 1 et 2 ans","Entre 2 et 3 ans","Plus de 3 ans","Je ne sais pas")

label_REPARATION <- c("Oui et le problème est resolu","Oui mais le problème na pas pu être résolu","Non, le problème s’est résolu tout seul au bout d’un moment","Non, peut être plus tard","Non, je ne pense pas tenter de résoudre le problème")

label_OS <- c("IOS (Apple)","Android","Autre","Je ne sais pas")

label_ETAT= c("Neuf","D'occasion","Reconditionné","Je ne sais pas" )

label_COHAB_2 <- c("Moins d'un mois","Entre 1 et 6 mois","Entre 6 mois et 2 ans","Plus de 2 ans")

label_RAISON_UTIL_PB <- c("Cela serait trop coûteux de résoudre le(s) problème(s) ou de remplacer mon smartphone",
"J’attends une opportunité", "Je ne peux pas résoudre le problème car le smartphone ne m’appartient pas","Je ne sais pas comment résoudre le(s) problème(s)","Je veux faire durer mon téléphone le plus longtemps possible","Ce(s) problème(s) ne m’impacte(nt) pas tant que ça au quotidien","Je n’ai pas pris le temps de m’en occuper, de chercher une solution","Mon téléphone est trop récent pour que je le fasse réparer ou que je le remplace","La résolution du (ou des) problème(s) est trop difficile ou incertaine","Ça me donne un prétexte pour moins l’utiliser","Cela ne vaut pas la peine de résoudre le(s) problème(s)","Mon smartphone a une particularité difficile à retrouver si je devais le remplacer","Autre")

label_IMPACT <- c("Usage global du smartphone","Communication ","Réseaux sociaux ","Cartes et guidage GPS","Jeux","Navigation web","Streaming musique et vidéo","Outils de productivité ","Logiciels et applications professionnelles dédiées","Photo, vidéo et autres activités de création","Identification bancaire, paiement sans contact","Tickets dématérialisés ","Courses et achats en ligne","Autre","Aucun")

label_dys <- c("Stockage","Matériel","Mise à jour","Dys divers")
```

```{r include=FALSE}
# Catégorisation des dysfonctionnements

label_dys <- c("Stockage","Matériel","Mise à jour","Dys divers")

materiel <- c(1,2,3,4,6,7,8,9,10,12,16,17)
dys_divers <- c(5,11,13,14,15,21,22,23,24,25)
stockage <- c(18)
maj <- c(19,20)

# Trouver la liste qui contient le plus d'éléments pour après définir le nombre de colonnes de notre matrice
max_length <- max(length(materiel), length(dys_divers), length(stockage), length(maj))

# Initialiser la matrice avec des zéros
matrice_cat <- matrix(0, nrow = 4, ncol = max_length)

# Remplir les lignes de la matrice avec les listes
matrice_cat[1, 1:length(stockage)] <- stockage
matrice_cat[2, 1:length(materiel)] <- materiel
matrice_cat[3, 1:length(maj)] <- maj
matrice_cat[4, 1:length(dys_divers)] <- dys_divers

# Afficher la matrice
print(matrice_cat)
```

**OBJECTIF :** *Synthétiser les grahes du module sociodémographique*

```{r include=FALSE}
# Import des données

data <- readRDS("/home/solene_petito/Bureau/Stage/Broken_devices/data/data1.rds") # base de données sur laquelle on va appliquer tous les changements

# Exporter la base de données en format Excel
write.xlsx(data, file = "/home/solene_petito/Bureau/Stage/Broken_devices/data/database.xlsx")

Broken_Devices_Data <- read.csv("/home/solene_petito/Bureau/Stage/Broken_devices/data/Broken-Devices-Data1-xlsx.csv",row.names=1) # base de données initiale sur laquelle on pourra se référer pour voir si les chgts ont bien été appliqués

# nombre d'observations
nb_obs <- nrow(data) # 968 

# nombre de variables 
nb_var <- ncol(data) # 164
```

```{r include=FALSE}
REPARATION <- c(1:5)
matrice_REP=matrix(0,nrow=2,ncol=length(REPARATION))
matrice_REP[1,]=REPARATION

colonne_deb <- which(names(data) == "REPARATION_A1")
#print(colonne_deb) # 81

colonne_fin <- which(names(data) == "REPARATION_A25")
#print(colonne_fin) # 105

df <- data[,colonne_deb:colonne_fin]

for (i in 1 :ncol(df)){
    for (j in 1:nrow(df)){
      val=df[j,i]
      if(!is.na(val)&& !is.null(val)){
        matrice_REP[2,val]=matrice_REP[2,val]+1
      }
    }
  }
```

## **I ) SEXE -- Sexe du répondant**

Vous êtes :

-   1 : Un homme

-   2 : Une femme

#### **1 ) Avec pondération**

```{r echo=FALSE}

# En utlisant la pondération

mat <- t(as.matrix(tapply(data$poids, data$SEXE, sum)))

pourcent_femmes=mat[1,2]*100/sum(mat[1,])
pourcent_hommes=mat[1,1]*100/sum(mat[1,])


df <- data.frame(Genre = c("Homme","Femme"), Nb_personnes = c(mat[1,1],mat[1,2]),Pourcent =c(pourcent_hommes,pourcent_femmes))

df$Pourcent = round(df$Pourcent)

total_row <- data.frame(
  Genre = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df


```

#### **2 ) Sans pondération**

```{r echo=FALSE}
# En n'utlisant PAS la pondération

mat <- t(as.matrix(table(data$SEXE)))

pourcent_femmes=mat[1,2]*100/sum(mat[1,])
pourcent_hommes=mat[1,1]*100/sum(mat[1,])


df <- data.frame(Genre = c("Homme","Femme"), Nb_personnes = c(mat[1,1],mat[1,2]),Pourcent =c(pourcent_hommes,pourcent_femmes))

df$Pourcent = round(df$Pourcent)

total_row <- data.frame(
  Genre = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df
```

## **II ) AGECLAIR -- Age du répondant en clair**

ANNEENAISS -- année de naissance du répondant : Quelle est votre année
de naissance ? :

-   1 : 2023

-   ... : ...

-   18 : 2006

-   19 : 2005

-   ... : ...

-   124 : 1900

**REMARQUE** : Grâce à ANNEENAISS l'âge a ensuite été calculé en clair.

#### **1 ) Avec pondération**

```{r echo=FALSE}
# En utlisant la pondération


mat <- t(as.matrix(tapply(data$poids, data$AGE, sum)))

res <- tapply(data$poids, data$AGE, sum)

pourcent=mat[1,]*100/sum(mat[1,])


df <- data.frame(Age = names(res), Nb_personnes = round(mat[1,],1),Pourcent =pourcent)

df$Pourcent = round(df$Pourcent,2)

total_row <- data.frame(
  Age = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df
```

#### **2 ) Sans pondération**

```{r echo=FALSE}
# En n'utlisant PAS la pondération

mat <- t(as.matrix(table(data$AGE)))

res <- table(data$AGE)

pourcent=mat[1,]*100/sum(mat[1,])


df <- data.frame(Age = names(res), Nb_personnes = round(mat[1,],1),Pourcent =pourcent)

df$Pourcent = round(df$Pourcent,1)

total_row <- data.frame(
  Age = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df
```

## **III ) TAGE5 -- Tranche d'âge en 5**

-   1 : Si AGECLAIR entre 15 et 24 ans : 15-24

-   2 : Si AGECLAIR entre 25 et 34 ans : 25-34

-   3 : Si AGECLAIR entre 35 et 49 ans : 35-49

-   4 : Si AGECLAIR entre 50 et 64 ans : 50-64

-   5 : Si AGECLAIR supérieur à 64 ans : 65+

**REMARQUE :** grâce à AGECLAIR la Tranche d'âge a ensuite été calculée

### **1 ) Avec pondération**

```{r echo=FALSE}
# En utlisant la pondération

don <- tapply(data$poids, data$Tage5, sum)

df <- data.frame(Tranche_Age =names(don), Nb_personnes = round(as.numeric(don)), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$Tranche_Age = factor(df$Tranche_Age,labels=c("15-24","25-34","35-49","50-64","65+"))

total_row <- data.frame(
  Tranche_Age = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

print(df)
```

### **2 ) Sans pondération**

```{r echo=FALSE}
# En n'utlisant PAS la pondération

don <- table(data$Tage5)

df <- data.frame(Tranche_Age =names(don), Nb_personnes = round(as.numeric(don)), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$Tranche_Age = factor(df$Tranche_Age,labels=c("15-24","25-34","35-49","50-64","65+"))

total_row <- data.frame(
  Tranche_Age = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

print(df)
```

## **IV ) DEPARTMT -- Département de résidence du répondant**

Dans quel département résidez-vous ?

-   1 : Ain

-   ... : ...

-   95 : Val d'Oise

#### **1 ) Avec pondération**

```{r echo=FALSE}
# En utlisant la pondération

mat <- t(as.matrix(tapply(data$poids, data$DEP, sum)))

res <- tapply(data$poids, data$DEP, sum)

pourcent=mat[1,]*100/sum(mat[1,])


df <- data.frame(DEP = names(res), Nb_personnes = round(mat[1,],1),Pourcent =pourcent)

df$Pourcent = round(df$Pourcent,2)

total_row <- data.frame(
  DEP = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df

```

#### **2 ) Sans pondération**

```{r echo=FALSE}
# En n'utlisant PAS la pondération

mat <- t(as.matrix(table(data$DEP)))

res <- table(data$DEP)

pourcent=mat[1,]*100/sum(mat[1,])


df <- data.frame(DEP = names(res), Nb_personnes = round(mat[1,],1),Pourcent =pourcent)

df$Pourcent = round(df$Pourcent,2)

total_row <- data.frame(
  DEP = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df

```

## **V ) UDA9 -- Région UDA en 9**

-   1 : Region Parisienne

-   2 : Nord

-   3 : Est

-   4 : Bassin Parisien Est

-   5 : Bassin Parisien Ouest

-   6 : Ouest

-   7 : Sud Ouest

-   8 : Sud Est

-   9 : Mediterrannee

**REMARQUE** : grâce à DEPARTMT, UDA9 a ensuite été déterminé

#### **1 ) Avec pondération**

```{r echo=FALSE}
# En utlisant la pondération

don <- tapply(data$poids, data$UDA9, sum)

df <- data.frame(UDA9 =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don))))

## Mettre les valeurs dans l'ordre décroissant
# df <- df %>% arrange( desc(Nb_personnes))

df$UDA9 = factor(df$UDA9,labels=c("Region Parisienne","Nord","Est","Bassin Parisien Est","Bassin Parisien Ouest" ,"Ouest","Sud Ouest","Sud Est","Mediterrannee"),)

total_row <- data.frame(
  UDA9 = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

#### **2 ) Sans pondération**

```{r echo=FALSE}
# En n'utilisant PAS la pondération

don <- table(data$UDA9)

df <- data.frame(UDA9 =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),2))

## Mettre les valeurs dans l'ordre décroissant
# df <- df %>% arrange( desc(Nb_personnes))

df$UDA9 = factor(df$UDA9,labels=c("Region Parisienne","Nord","Est","Bassin Parisien Est","Bassin Parisien Ouest" ,"Ouest","Sud Ouest","Sud Est","Mediterrannee"),)

total_row <- data.frame(
  UDA9 = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

## **VI ) ACTIVPRO -- Activité du répondant**

Actuellement, exercez-vous une activité professionnelle ?

-   1 : Oui

-   2 : Non

\####**1 ) Si ACTIVPRO = 1 (Oui)**

ACTIF -- Profession du répondant actif

Quelle activité professionnelle exercez-vous actuellement ?

-   1 : Agriculteur (agriculteur, éleveur, maraîcher, viticulteur,
    patron pêcheur, exploitant forestier, exploitant agricole ...)

-   2 : Artisan (maçon, menuisier, boulanger, boucher, charcutier,
    coiffeur, taxi... de moins de 10 salariés)

-   3 : Commerçant (alimentation, hôtel, restaurant, fleuriste,
    poissonnier, meubles, habits, voyage ...de moins de 10 salariés)

-   4 : Chef d'entreprise de 10 salariés et plus (quel que soit le
    secteur)

-   5 : Cadre de la fonction publique (Etat, collectivités locales,
    hôpitaux) catégorie A, officier des armées et de la gendarmerie

-   6 : Profession de l'information, arts et spectacles (journaliste,
    écrivain, acteur...)

-   7 : Cadre d'entreprise : administratif, commercial, ingénieur, cadre
    technique

-   8 : Profession libérale (médecin, avocat, notaire, expert-comptable,
    architecte, dentiste...)

-   9 : Professeur en lycée d'enseignement général, professeur dans
    l'enseignement supérieur, profession scientifique

-   10 : Professeur des écoles, instituteur, professeur en collège ou
    lycée technique

-   11 : Profession intermédiaire de la santé et du social (infirmier,
    sage-femme, masseur-kinésithérapeute, opticien, éducateur)

-   12 : Clergé, religieux

-   13 : Profession intermédiaire de la fonction publique de catégorie B
    (inspecteur de police, contrôleur des impôts, adjudant-chef...)

-   14 : Profession intermédiaire d'entreprise (administratif,
    commercial ...) (secrétaire de direction, technicien d'études, de
    fabrication...)

-   15 : Contremaître, agent de maîtrise (conducteur, chef de chantiers,
    responsable d'entrepôt...)

-   16 : Employé civil, agent de services de la fonction publique,
    policier, militaire non officier, pompier, aide-soignant, assistante
    maternelle, ambulancier, facteur, cantinier

-   17 : Employé d'entreprise (administratif, secrétaire), vendeur,
    personnel des services directs aux particuliers (coiffeur,
    concierge, femme de ménage, aide-ménagère...)

-   18 : Ouvrier qualifié, non qualifié, ouvrier agricole, chauffeur,
    conducteur, plombier, jardinier, cuisinier, éboueur, agencier,
    chaudronnier, électricien, soudeur...)

**Avec pondération**

```{r echo=FALSE}
# En utilisant la pondération

df = data[,c("INACTIFS","QACTIF","poids")]
indices <- which(df$INACTIFS == 1 )
df=df[-c(indices),]

df = df[,c("QACTIF","poids")]
df=na.omit(df)
don <- tapply(df$poids, df$QACTIF, sum)

df <- data.frame(Actifs =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$Actifs = factor(df$Actifs,labels=c("Agriculteurs","Artisans","Commerçants","Chef d'entreprise de 10 salariés et plus","Cadres de la fonction publique, officier des armées et de la gendarmerie","Professions de l'information, arts et spectacles","Cadres d'entreprise: administratifs, commerciaux, ingénieurs, cadres techniques","Professions libérales","Professeurs en lycée d'enseignement général, professeurs dans l'enseignement supérieur, professions scientifiques","Professeurs des écoles, instituteurs, professeurs en collège ou lycée technique","Professions intermédiaires de la santé et du social","Clergé, religieux","Professions intermédiaires de la fonction publique","Professions intermédiaires d'entreprise ","Contremaîtres, agents de maîtrise","Employés civils, agents de services de la fonction publique","Employés d'entreprise (administratifs, secrétaires), vendeurs, personnel des services directs aux particuliers","Ouvriers"))

total_row <- data.frame(
  Actifs = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

**Sans pondération**

```{r echo=FALSE}
# En n'utilisant pas la pondération

df = data[,c("INACTIFS","QACTIF","poids")]
indices <- which(df$INACTIFS == 1 )
df=df[-c(indices),]

df = df[,c("QACTIF","poids")]
df=na.omit(df)
don <- table(df$QACTIF)

df <- data.frame(Actifs =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$Actifs = factor(df$Actifs,labels=c("Agriculteurs","Artisans","Commerçants","Chef d'entreprise de 10 salariés et plus","Cadres de la fonction publique, officier des armées et de la gendarmerie","Professions de l'information, arts et spectacles","Cadres d'entreprise: administratifs, commerciaux, ingénieurs, cadres techniques","Professions libérales","Professeurs en lycée d'enseignement général, professeurs dans l'enseignement supérieur, professions scientifiques","Professeurs des écoles, instituteurs, professeurs en collège ou lycée technique","Professions intermédiaires de la santé et du social","Clergé, religieux","Professions intermédiaires de la fonction publique","Professions intermédiaires d'entreprise ","Contremaîtres, agents de maîtrise","Employés civils, agents de services de la fonction publique","Employés d'entreprise (administratifs, secrétaires), vendeurs, personnel des services directs aux particuliers","Ouvriers"))

total_row <- data.frame(
  Actifs = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

\####**2 ) Si ACTIVPRO = 2 (Non)**

INACTIF -- Type d'inactivité du répondant

Êtes-vous :

-   1 : Chômeur(se) ayant déjà travaillé

-   2 : Chômeur(se) n'ayant jamais travaillé

-   3 :Retraité(e)

-   4 : Lycéen(ne), collégien(ne)

-   5 : Étudiant(e)

-   6 : Femme ou homme au foyer

-   7 : Autre

**Avec pondération :**

```{r echo=FALSE}
# En utilisant la pondération

df = data[,c("INACTIFS","poids")]
df=na.omit(df)
don <- tapply(df$poids, df$INACTIFS, sum)

df <- data.frame(Inactifs =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))

# df <- df %>% arrange( desc(Nb_personnes))

df$Inactifs = factor(df$Inactifs,labels=c("Chômeur ayant déjà travaillé","Chômeur n'ayant jamais travaillé","Retraité","lycéen, collégien","Etudiant","Femme ou Homme au foyer","Autre"))

total_row <- data.frame(
  Inactifs = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

**Sans pondération :**

```{r echo=FALSE}
# En n'utilisant PAS la pondération

df = data[,c("INACTIFS","poids")]
df=na.omit(df)
don <- table(df$INACTIFS)

df <- data.frame(Inactifs =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),2))

# df <- df %>% arrange( desc(Nb_personnes))

df$Inactifs = factor(df$Inactifs,labels=c("Chômeur ayant déjà travaillé","Chômeur n'ayant jamais travaillé","Retraité","lycéen, collégien","Etudiant","Femme ou Homme au foyer","Autre"))

total_row <- data.frame(
  Inactifs = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

**Filtre : Si INACTIF = 1 (Chômeur(se) ayant déjà travaillé)**

EXACTIF - Ancienne profession du répondant au chômage

Quelle est la dernière profession que vous ayez exercée ?

-   1 : Agriculteur (agriculteur, éleveur, maraîcher, viticulteur,
    patron pêcheur, exploitant forestier, exploitant agricole ...)

-   2 : Artisan (maçon, menuisier, boulanger, boucher, charcutier,
    coiffeur, taxi... de moins de 10 salariés)

-   3 : Commerçant (alimentation, hôtel, restaurant, fleuriste,
    poissonnier, meubles, habits, voyage ...de moins de 10 salariés)

-   4 : Chef d'entreprise de 10 salariés et plus (quel que soit le
    secteur)

-   5 : Cadre de la fonction publique (Etat, collectivités locales,
    hôpitaux) catégorie A, officier des armées et de la gendarmerie

-   6 : Profession de l'information, arts et spectacles (journaliste,
    écrivain, acteur...)

-   7 : Cadre d'entreprise : administratif, commercial, ingénieur, cadre
    technique

-   8 : Profession libérale (médecin, avocat, notaire, expert-comptable,
    architecte, dentiste...)

-   9 : Professeur en lycée d'enseignement général, professeur dans
    l'enseignement supérieur, profession scientifique

-   10 : Professeur des écoles, instituteur, professeur en collège ou
    lycée technique

-   11 : Profession intermédiaire de la santé et du social (infirmier,
    sage-femme, masseur-kinésithérapeute, opticien, éducateur)

-   12 : Clergé, religieux

-   13 : Profession intermédiaire de la fonction publique de catégorie B
    (inspecteur de police, contrôleur des impôts, adjudant-chef...)

-   14 : Profession intermédiaire d'entreprise (administratif,
    commercial ...) (secrétaire de direction, technicien d'études, de
    fabrication...)

-   15 : Contremaître, agent de maîtrise (conducteur, chef de chantiers,
    responsable d'entrepôt...)

-   16 : Employé civil, agent de services de la fonction publique,
    policier, militaire non officier, pompier, aide-soignant, assistante
    maternelle, ambulancier, facteur, cantinier

-   17 : Employé d'entreprise (administratif, secrétaire), vendeur,
    personnel des services directs aux particuliers (coiffeur,
    concierge, femme de ménage, aide-ménagère...)

-   18 : Ouvrier qualifié, non qualifié, ouvrier agricole, chauffeur,
    conducteur, plombier, jardinier, cuisinier, éboueur, agencier,
    chaudronnier, électricien, soudeur...)

**Avec pondération**

```{r echo=FALSE}
df = data[,c("INACTIFS","QACTIF","poids")]
indices <- which(df$INACTIFS == 1 )
df=df[c(indices),]

df = df[,c("QACTIF","poids")]
df=na.omit(df)
don <- tapply(df$poids, df$QACTIF, sum)

df <- data.frame(Inactifs_Actifs =names(don), Nb_personnes = round(as.numeric(don),1))

# df <- df %>% arrange( desc(Nb_personnes))

df$Inactifs_Actifs = factor(df$Inactifs_Actifs,labels=c("Agriculteurs","Artisans","Commerçants","Chef d'entreprise de 10 salariés et plus","Cadres de la fonction publique, officier des armées et de la gendarmerie","Professions de l'information, arts et spectacles","Cadres d'entreprise: administratifs, commerciaux, ingénieurs, cadres techniques","Professions libérales","Professeurs en lycée d'enseignement général, professeurs dans l'enseignement supérieur, professions scientifiques","Professeurs des écoles, instituteurs, professeurs en collège ou lycée technique","Professions intermédiaires de la santé et du social","Clergé, religieux","Professions intermédiaires de la fonction publique","Professions intermédiaires d'entreprise ","Contremaîtres, agents de maîtrise","Employés civils, agents de services de la fonction publique","Employés d'entreprise (administratifs, secrétaires), vendeurs, personnel des services directs aux particuliers","Ouvriers"))

df=df[rowSums(is.na(df)) != ncol(df)-1, ]
df$Pourcent = round(df$Nb_personnes*100/sum(df$Nb_personnes),2)

total_row <- data.frame(
  Inactifs_Actifs = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

**Sans pondération**

```{r echo=FALSE}
df = data[,c("INACTIFS","QACTIF","poids")]
indices <- which(df$INACTIFS == 1 )
df=df[c(indices),]

df = df[,c("QACTIF","poids")]
df=na.omit(df)
don <- table(df$QACTIF)

df <- data.frame(Inactifs_Actifs =names(don), Nb_personnes = round(as.numeric(don),1))

# df <- df %>% arrange( desc(Nb_personnes))

df$Inactifs_Actifs = factor(df$Inactifs_Actifs,labels=c("Agriculteurs","Artisans","Commerçants","Chef d'entreprise de 10 salariés et plus","Cadres de la fonction publique, officier des armées et de la gendarmerie","Professions de l'information, arts et spectacles","Cadres d'entreprise: administratifs, commerciaux, ingénieurs, cadres techniques","Professions libérales","Professeurs en lycée d'enseignement général, professeurs dans l'enseignement supérieur, professions scientifiques","Professeurs des écoles, instituteurs, professeurs en collège ou lycée technique","Professions intermédiaires de la santé et du social","Clergé, religieux","Professions intermédiaires de la fonction publique","Professions intermédiaires d'entreprise ","Contremaîtres, agents de maîtrise","Employés civils, agents de services de la fonction publique","Employés d'entreprise (administratifs, secrétaires), vendeurs, personnel des services directs aux particuliers","Ouvriers"))

df=df[rowSums(is.na(df)) != ncol(df)-1, ]
df$Pourcent = round(df$Nb_personnes*100/sum(df$Nb_personnes),2)

total_row <- data.frame(
  Inactifs_Actifs = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)

df <- df[df$Nb_personnes!=0,]



print(df)
```

## **VII ) CSP9 -- CSP en 9 du répondant**

-   1 Agriculteurs

-   2 Artisans/ Commerçant

-   3 Cadres

-   4 Professions Intermédiaires

-   5 Employés

-   6 Ouvriers

-   7 Retraités

-   8 Etudiants

-   9 Autres Inactifs

#### **1 ) Avec pondération**

```{r echo=FALSE}
# En utlisant la pondération

don <- tapply(data$poids, data$CSP9, sum)

df <- data.frame(CSP9 =names(don), Nb_personnes = round(as.numeric(don),1),Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),2))

# df <- df %>% arrange( desc(Nb_personnes))

df$CSP9 = factor(df$CSP9,labels=c("Agriculteurs","Artisans","Cadres","Professions Intermédiaires","Employés","Ouvriers","Retraités","Etudiants","Autres Inactifs"))

total_row <- data.frame(
  CSP9 = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

#### **2 ) Sans pondération**

```{r echo=FALSE}
# En n'utlisant PAS la pondération

# En utlisant la pondération

don <- table(data$CSP9)

df <- data.frame(CSP9 =names(don), Nb_personnes = round(as.numeric(don),1),Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),2))

# df <- df %>% arrange( desc(Nb_personnes))

df$CSP9 = factor(df$CSP9,labels=c("Agriculteurs","Artisans","Cadres","Professions Intermédiaires","Employés","Ouvriers","Retraités","Etudiants","Autres Inactifs"))

total_row <- data.frame(
  CSP9 = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)

```

## **VIII ) CSP en 5 du répondant**

-   1 : CSP+

-   2 : CSP-

-   3 : Retraités

-   4 : Étudiants

-   5 : Autres inactifs

#### **1 ) Avec pondération**

```{r echo=FALSE}
don <- tapply(data$poids, data$CSP5, sum)

df <- data.frame(CSP5 =names(don), Nb_personnes = round(as.numeric(don),1),Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$CSP5 = factor(df$CSP5,labels=c("CSP+","CSP-","Retraités","Etudiants","Autres Inactifs"))

total_row <- data.frame(
  CSP5 = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

#### **2 ) Sans pondération**

```{r echo=FALSE}
don <- table(data$CSP5)

df <- data.frame(CSP5 =names(don), Nb_personnes = round(as.numeric(don),1),Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$CSP5 = factor(df$CSP5,labels=c("CSP+","CSP-","Retraités","Etudiants","Autres Inactifs"))

total_row <- data.frame(
  CSP5 = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

## **IX ) CNIVETUDES -- Niveau d'études du répondant**

Quel niveau d'études avez-vous atteint ?

-   1 CAP/BEP

-   2 Baccalauréat

-   3 Baccalauréat +2/BTS

-   4 Baccalauréat +3/Licence

-   5 Baccalauréat +4, +5/ Master

-   6 Doctorat 7

-   Pas de diplôme

#### **1 ) Avec pondération**

```{r echo=FALSE}
don <- tapply(data$poids, data$NIVETUDES, sum)

df <- data.frame(NIVETUDES =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))

#df <- df %>%  arrange( desc(Nb_personnes))

df$NIVETUDES = factor(df$NIVETUDES,labels=c("CAP/BEP","Baccalauréat","Baccalauréat +2/BTS","Baccalauréat +3/Licence","Baccalauréat +4, +5/ Master","Doctorat","Pas de diplôme"))

total_row <- data.frame(
  NIVETUDES = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

#### **2 ) Sans pondération**

```{r echo=FALSE}
don <- table(data$NIVETUDES)

df <- data.frame(NIVETUDES =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))
df <- df %>% 
  arrange( desc(Nb_personnes))

df$NIVETUDES = factor(df$NIVETUDES,labels=c("CAP/BEP","Baccalauréat","Baccalauréat +2/BTS","Baccalauréat +3/Licence","Baccalauréat +4, +5/ Master","Doctorat","Pas de diplôme"))

total_row <- data.frame(
  NIVETUDES = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

## **X ) NOMBREFOYER -- Nombre de personnes au foyer**

Combien de personnes AU TOTAL vivent dans votre foyer y compris
vous-même ?

-   1 : 1 personne 2

-   2 : personnes 3

-   3 : personnes 4

-   4 : personnes ou plus

#### **1 ) Avec pondération**

```{r echo=FALSE}

don <- tapply(data$poids, data$NPF5, sum)

df <- data.frame(NPF =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))

# df <- df %>% arrange( desc(Nb_personnes))

df$NPF = factor(df$NPF,labels=c("1 personne","2 personnes","3 personnes","4 personnes","5 personnes ou plus"))

total_row <- data.frame(
  NPF = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```

#### **2 ) Sans pondération**

```{r echo=FALSE}

don <- table(data$NPF5)

df <- data.frame(NPF =names(don), Nb_personnes = round(as.numeric(don),1), Pourcent= round(as.numeric(don)*100/sum(as.numeric(don)),1))

# df <- df %>% arrange( desc(Nb_personnes))

df$NPF = factor(df$NPF,labels=c("1 personne","2 personnes","3 personnes","4 personnes","5 personnes ou plus"))

total_row <- data.frame(
  NPF = "Total",
  Nb_personnes = sum(df$Nb_personnes),
  Pourcent = sum(df$Pourcent)
)

df <- rbind(df, total_row)



print(df)
```





